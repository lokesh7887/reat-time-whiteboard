(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{7933:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomId]",function(){return n(3452)}])},8374:function(e,t,n){"use strict";n.d(t,{r:function(){return s}});let s=[...Object.values({PURPLE:"#6B32F3",BLUE:"#408FF8",RED:"#F32D27",GREEN:"#6FCB12",GOLD:"#A89D6C",PINK:"#EB29DA",MINT:"#19CB87",RED_LIGHT:"#ED7878",CYAN:"#02CBF6",RED_DARK:"#BA1555",ORANGE:"#FF7300"})]},7160:function(e,t,n){"use strict";n.d(t,{W:function(){return s}});let s=(0,n(2599).io)()},7912:function(e,t,n){"use strict";n.d(t,{NW:function(){return s.NW},av:function(){return s.av},bo:function(){return s.bo},u4:function(){return s.u4}}),n(334);var s=n(8435)},334:function(e,t,n){"use strict";n.d(t,{X:function(){return r},p:function(){return l}});var s=n(2804);let l={id:"",users:new Map,usersMoves:new Map,movesWithoutUser:[],myMoves:[]},r=(0,s.cn)({key:"room",default:l})},8435:function(e,t,n){"use strict";n.d(t,{av:function(){return u},NW:function(){return o},bb:function(){return a},u4:function(){return c},bo:function(){return d}});var s=n(2804),l=n(8374);let r=e=>{let t=l.r.findIndex(t=>t===e);return -1===t?l.r[0]:l.r[(t+1)%l.r.length]};var i=n(334);let o=()=>(0,s.sJ)(i.X),a=()=>(0,s.Zl)(i.X),c=()=>{let e=(0,s.Zl)(i.X);return t=>{e({...i.p,id:t})}},d=()=>{let e=(0,s.Zl)(i.X);return{handleAddUser:(t,n)=>{e(e=>{var s;let l=e.users,i=e.usersMoves,o=r(null===(s=[...l.values()].pop())||void 0===s?void 0:s.color);return l.set(t,{name:n,color:o}),i.set(t,[]),{...e,users:l,usersMoves:i}})},handleRemoveUser:t=>{e(e=>{let n=e.users,s=e.usersMoves,l=s.get(t);return n.delete(t),s.delete(t),{...e,users:n,usersMoves:s,movesWithoutUser:[...e.movesWithoutUser,...l||[]]}})},handleAddMoveToUser:(t,n)=>{e(e=>{let s=e.usersMoves,l=e.usersMoves.get(t);return s.set(t,[...l||[],n]),{...e,usersMoves:s}})},handleRemoveMoveFromUser:t=>{e(e=>{let n=e.usersMoves,s=e.usersMoves.get(t);return null==s||s.pop(),n.set(t,s||[]),{...e,usersMoves:n}})}}},u=()=>{let[e,t]=(0,s.FV)(i.X);return{handleAddMyMove:e=>{t(t=>{var n;return(null===(n=t.myMoves[t.myMoves.length-1])||void 0===n?void 0:n.options.mode)==="select"?{...t,myMoves:[...t.myMoves.slice(0,t.myMoves.length-1),e]}:{...t,myMoves:[...t.myMoves,e]}})},handleRemoveMyMove:()=>{let n=[...e.myMoves],s=n.pop();return t(e=>({...e,myMoves:n})),s},myMoves:e.myMoves}}},8277:function(e,t,n){"use strict";var s=n(5893),l=n(6691),r=n(8147);t.Z=e=>{let{id:t}=e,{closeModal:n}=(0,r.d)();return(0,s.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10 ",children:[(0,s.jsx)("button",{onClick:n,className:"absolute top-5 right-5",children:(0,s.jsx)(l.oHP,{})}),(0,s.jsxs)("h2",{className:"text-lg font-bold",children:['Room with id "',t,'" does not exist or is full!']}),(0,s.jsx)("h3",{children:"Try to join room later."})]})}},3452:function(e,t,n){"use strict";let s;n.r(t),n.d(t,{default:function(){return eZ}});var l=n(5893),r=n(7912),i=n(7294),o=n(4960),a=n(782),c=n(8374),d=n(7160),u=n(8435);let h=(0,i.createContext)(null);var m=e=>{let{children:t}=e,n=(0,u.bb)(),{users:s}=(0,u.NW)(),{handleAddUser:m,handleRemoveUser:f}=(0,r.bo)(),x=(0,i.useRef)(null),g=(0,i.useRef)(null),v=(0,i.useRef)(null),b=(0,i.useRef)(null),p=(0,i.useRef)(null),w=(0,i.useRef)([]),[j,y]=(0,i.useState)({base64:""}),N=(0,o.c)(0),k=(0,o.c)(0);return(0,i.useEffect)(()=>(d.W.on("room",(e,t,s)=>{let l=new Map(JSON.parse(t)),r=new Map(JSON.parse(s)),i=new Map;r.forEach((e,t)=>{if(t===d.W.id)return;let n=[...r.keys()].indexOf(t),s=c.r[n%c.r.length];i.set(t,{name:e,color:s})}),n(t=>({...t,users:i,usersMoves:l,movesWithoutUser:e.drawed}))}),d.W.on("new_user",(e,t)=>{(0,a.Am)("".concat(t," has joined the room."),{position:"top-center",theme:"colored"}),m(e,t)}),d.W.on("user_disconnected",e=>{var t;(0,a.Am)("".concat((null===(t=s.get(e))||void 0===t?void 0:t.name)||"Anonymous"," has left the room."),{position:"top-center",theme:"colored"}),f(e)}),()=>{d.W.off("room"),d.W.off("new_user"),d.W.off("user_disconnected")}),[m,f,n,s]),(0,l.jsx)(h.Provider,{value:{x:N,y:k,bgRef:b,undoRef:x,redoRef:g,canvasRef:v,setMoveImage:y,moveImage:j,minimapRef:p,selectionRefs:w},children:t})},f=n(3830),x=n(5711);let g={width:4e3,height:2e3},v=()=>{let[e,t]=(0,i.useState)(0),[n,s]=(0,i.useState)(0);return(0,i.useEffect)(()=>{let e=()=>{t(window.innerWidth),s(window.innerHeight)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),{width:e,height:n}},b=()=>{let{x:e,y:t}=(0,i.useContext)(h);return{x:e,y:t}},p=()=>{let{undoRef:e,bgRef:t,canvasRef:n,minimapRef:s,redoRef:l,selectionRefs:r}=(0,i.useContext)(h);return{undoRef:e,redoRef:l,bgRef:t,canvasRef:n,minimapRef:s,selectionRefs:r}},w=()=>{let{canvasRef:e}=p(),[t,n]=(0,i.useState)();return(0,i.useEffect)(()=>{var t;let s=null===(t=e.current)||void 0===t?void 0:t.getContext("2d");s&&(s.lineJoin="round",s.lineCap="round",n(s))},[e]),t},j={circle:{cX:0,cY:0,radiusX:0,radiusY:0},rect:{width:0,height:0},path:[],options:{shape:"line",mode:"draw",lineWidth:1,lineColor:{r:0,g:0,b:0,a:0},fillColor:{r:0,g:0,b:0,a:0},selection:null},id:"",img:{base64:""},timestamp:0},y=(e,t)=>e-t.get(),N=e=>"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(e.a,")");var k=n(2804);let E=(0,k.cn)({key:"options",default:{lineColor:{r:0,g:0,b:0,a:1},fillColor:{r:0,g:0,b:0,a:0},lineWidth:5,mode:"draw",shape:"line",selection:null}}),C=()=>(0,k.sJ)(E),W=()=>(0,k.Zl)(E),M=()=>(0,k.FV)(E),S=()=>{let e=W();return{setSelection:t=>{e(e=>({...e,selection:t}))},clearSelection:()=>{e(e=>({...e,selection:null}))}}},L=(0,k.cn)({key:"saved_moves",default:[]}),R=()=>{let e=(0,k.Zl)(L);return{addSavedMove:t=>{"select"!==t.options.mode&&e(e=>[t,...e])},removeSavedMove:()=>{let t;return e(e=>(t=e.at(0),e.slice(1))),t},clearSavedMoves:()=>{e([])}}},P=()=>(0,k.sJ)(L),_=(e,t,n,s)=>{let l=e-n[0],r=t-n[1];return s?Math.abs(l)>Math.abs(r)?l=l>0&&r<0||l<0&&r>0?-r:r:r=r>0&&l<0||r<0&&l>0?-l:l:(l=e-n[0],r=t-n[1]),{width:l,height:r}},T=(e,t,n,s,l)=>{e.beginPath();let{width:r,height:i}=_(n,s,t,l),o=t[0]+r/2,a=t[1]+i/2,c=Math.abs(r/2),d=Math.abs(i/2);return e.ellipse(o,a,c,d,0,0,2*Math.PI),e.stroke(),e.fill(),e.closePath(),{cX:o,cY:a,radiusX:c,radiusY:d}},I=(e,t,n,s,l,r)=>{e.beginPath();let{width:i,height:o}=_(n,s,t,l);return r?e.fillRect(t[0],t[1],i,o):e.rect(t[0],t[1],i,o),e.stroke(),e.fill(),e.closePath(),{width:i,height:o}},D=(e,t,n,s,l)=>{if(l){e.beginPath(),e.lineTo(t[0],t[1]),e.lineTo(n,s),e.stroke(),e.closePath();return}e.lineTo(n,s),e.stroke()},z=[],F={cX:0,cY:0,radiusX:0,radiusY:0},A={width:0,height:0},X=e=>{let t=C(),n=b(),{clearSavedMoves:l}=R(),{handleAddMyMove:o}=(0,r.av)(),{setSelection:a,clearSelection:c}=S(),u=n.x,h=n.y,[m,f]=(0,i.useState)(!1),x=w(),g=()=>{x&&(x.lineWidth=t.lineWidth,x.strokeStyle=N(t.lineColor),x.fillStyle=N(t.fillColor),"eraser"===t.mode?x.globalCompositeOperation="destination-out":x.globalCompositeOperation="source-over")},v=()=>{s||(s=null==x?void 0:x.getImageData(0,0,x.canvas.width,x.canvas.height)),s&&(null==x||x.putImageData(s,0,0))},p=()=>{v(),s=void 0};return{handleEndDrawing:()=>{if(!x||e)return;f(!1),x.closePath();let n=!0;if("select"===t.mode&&z.length){p();let e=z[0][0],t=z[0][1],s=z[z.length-1][0]-e,l=z[z.length-1][1]-t;s<0?(s-=4,e+=2):(s+=4,e-=2),l<0?(l-=4,t+=2):(l+=4,t-=2),(s<4||s>4)&&(l<4||l>4)?a({x:e,y:t,width:s,height:l}):(c(),n=!1)}let s={...j,rect:{...A},circle:{...F},path:z,options:t};z=[],F={cX:0,cY:0,radiusX:0,radiusY:0},A={width:0,height:0},"select"!==t.mode?(d.W.emit("draw",s),l()):n&&o(s)},handleDraw:(n,s,l)=>{if(!x||!m||e)return;let[r,i]=[y(n,u),y(s,h)];if(v(),"select"===t.mode){x.fillStyle="rgba(0, 0, 0, 0.2)",I(x,z[0],r,i,!1,!0),z.push([r,i]),g();return}switch(t.shape){case"line":l&&(z=z.slice(0,1)),D(x,z[0],r,i,l),z.push([r,i]);break;case"circle":F=T(x,z[0],r,i,l);break;case"rect":A=I(x,z[0],r,i,l)}},handleStartDrawing:(n,s)=>{if(!x||e||e)return;let[l,r]=[y(n,u),y(s,h)];f(!0),g(),v(),"line"===t.shape&&"select"!==t.mode&&(x.beginPath(),x.lineTo(l,r),x.stroke()),z.push([l,r])},drawing:m,clearOnYourMove:p}},O=(0,k.cn)({key:"bg",default:{mode:"light",lines:!0}}),Z=()=>{let e=(0,k.sJ)(O);return(0,i.useEffect)(()=>{let t=window.document.documentElement;"dark"===e.mode?(t.classList.remove("light"),t.classList.add("dark")):(t.classList.remove("dark"),t.classList.add("light"))},[e.mode]),e},U=()=>{let e=(0,k.Zl)(O);return(t,n)=>{e({mode:t,lines:n})}},Y=()=>{let{moveImage:e,setMoveImage:t}=(0,i.useContext)(h);return{moveImage:e,setMoveImage:t}},B={x:0,y:0,width:0,height:0},J=e=>{let t=w(),n=C(),{selection:s}=n,{bgRef:l,selectionRefs:r}=p(),{setMoveImage:o}=Y();(0,i.useEffect)(()=>{let n=async()=>{t&&s&&(await e(),setTimeout(()=>{let{x:e,y:n,width:l,height:r}=s;t.lineWidth=2,t.strokeStyle="#000",t.setLineDash([5,10]),t.globalCompositeOperation="source-over",t.beginPath(),t.rect(e,n,l,r),t.stroke(),t.closePath(),t.setLineDash([])},10))};return(B.width!==(null==s?void 0:s.width)||B.height!==(null==s?void 0:s.height)||B.x!==(null==s?void 0:s.x)||B.y!==(null==s?void 0:s.y))&&n(),()=>{s&&(B=s)}},[s,t]);let c=(0,i.useMemo)(()=>{if(s){let{x:e,y:t,width:n,height:l}=s;return n<0?(n+=4,e-=2):(n-=4,e+=2),l<0?(l+=4,t-=2):(l-=4,t+=2),{x:e,y:t,width:n,height:l}}return{width:0,height:0,x:0,y:0}},[s]),u=async e=>{if(!s)return null;let{x:n,y:r,width:i,height:o}=c,a=null==t?void 0:t.getImageData(n,r,i,o);if(a){let t=document.createElement("canvas");t.width=i,t.height=o;let s=document.createElement("canvas");s.width=i,s.height=o;let c=s.getContext("2d");if(c&&l.current){var d;let u=null===(d=l.current.getContext("2d"))||void 0===d?void 0:d.getImageData(n,r,i,o);u&&e&&c.putImageData(u,0,0);let h=t.getContext("2d");return null==h||h.putImageData(a,0,0),c.drawImage(t,0,0),await new Promise(e=>{s.toBlob(t=>{t&&e(t)})})}}return null},h=()=>{if(!s)return null;let{x:e,y:t,width:l,height:r}=c;l<0?(l+=4,e-=2):(l-=4,e+=2),r<0?(r+=4,t-=2):(r-=4,t+=2);let i={...j,rect:{width:l,height:r},path:[[e,t]],options:{...n,shape:"rect",mode:"eraser",fillColor:{r:0,g:0,b:0,a:1}}};return d.W.emit("draw",i),i},m=async()=>{let e=await u(!0);e&&navigator.clipboard.write([new ClipboardItem({"image/png":e})]).then(()=>{(0,a.Am)("Copied to clipboard!",{position:"top-center",theme:"colored"})})};(0,i.useEffect)(()=>{let e=async e=>{"c"===e.key&&e.ctrlKey&&m(),"Delete"===e.key&&s&&h()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[l,h,t,m,u,n,s]),(0,i.useEffect)(()=>{let e=async()=>{if(s){let e=await u();if(!e)return;let{x:t,y:n,width:s,height:l}=c,r=new FileReader;r.readAsDataURL(e),r.addEventListener("loadend",()=>{var e;let i=null===(e=r.result)||void 0===e?void 0:e.toString();i&&(h(),o({base64:i,x:Math.min(t,t+s),y:Math.min(n,n+l)}))})}};if(r.current){let t=r.current[0],n=r.current[1],s=r.current[2];return t.addEventListener("click",e),n.addEventListener("click",m),s.addEventListener("click",h),()=>{null==t||t.removeEventListener("click",e),null==n||n.removeEventListener("click",m),null==s||s.removeEventListener("click",h)}}return()=>{}},[h,c,m,u,s,r,o])},K=0,H=e=>{let{canvasRef:t,minimapRef:n,bgRef:s}=p(),l=(0,r.NW)(),{handleAddMyMove:o,handleRemoveMyMove:a}=(0,r.av)(),{addSavedMove:c,removeSavedMove:u}=R(),h=w(),m=Z(),{clearSelection:f}=S(),x=(0,i.useMemo)(()=>{let{usersMoves:e,movesWithoutUser:t,myMoves:n}=l,s=[...t,...n];return e.forEach(e=>s.push(...e)),s.sort((e,t)=>e.timestamp-t.timestamp),s},[l]),g=()=>{if(t.current&&n.current&&s.current){let e=n.current.getContext("2d");e&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(s.current,0,0,e.canvas.width,e.canvas.height),e.drawImage(t.current,0,0,e.canvas.width,e.canvas.height))}};(0,i.useEffect)(()=>g(),[m]);let v=(e,t)=>{let{path:n}=e;if(!h||!n.length)return;let s=e.options;if("select"!==s.mode){switch(h.lineWidth=s.lineWidth,h.strokeStyle=N(s.lineColor),h.fillStyle=N(s.fillColor),"eraser"===s.mode?h.globalCompositeOperation="destination-out":h.globalCompositeOperation="source-over","image"===s.shape&&t&&h.drawImage(t,n[0][0],n[0][1]),s.shape){case"line":h.beginPath(),n.forEach(e=>{let[t,n]=e;h.lineTo(t,n)}),h.stroke(),h.closePath();break;case"circle":{let{cX:t,cY:n,radiusX:s,radiusY:l}=e.circle;h.beginPath(),h.ellipse(t,n,s,l,0,0,2*Math.PI),h.stroke(),h.fill(),h.closePath();break}case"rect":{let{width:t,height:s}=e.rect;h.beginPath(),h.rect(n[0][0],n[0][1],t,s),h.stroke(),h.fill(),h.closePath()}}g()}},b=async()=>{if(!h)return;h.clearRect(0,0,h.canvas.width,h.canvas.height);let e=await Promise.all(x.filter(e=>"image"===e.options.shape).map(e=>new Promise(t=>{let n=new Image;n.src=e.img.base64,n.id=e.id,n.addEventListener("load",()=>t(n))})));x.forEach(t=>{if("image"===t.options.shape){let n=e.find(e=>e.id===t.id);n&&v(t,n)}else v(t)}),g()};J(b),(0,i.useEffect)(()=>(d.W.on("your_move",t=>{e(),o(t),setTimeout(f,100)}),()=>{d.W.off("your_move")}),[e,f,o]),(0,i.useEffect)(()=>{if(K>=x.length||!K)b();else{let e=x[x.length-1];if("image"===e.options.shape){let t=new Image;t.src=e.img.base64,t.addEventListener("load",()=>v(e,t))}else v(e)}return()=>{K=x.length}},[x]);let j=()=>{if(h){let e=a();(null==e?void 0:e.options.mode)==="select"?f():e&&(c(e),d.W.emit("undo"))}},y=()=>{if(h){let e=u();e&&d.W.emit("draw",e)}};return(0,i.useEffect)(()=>{let e=e=>{"z"===e.key&&e.ctrlKey?j():"y"===e.key&&e.ctrlKey&&y()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[j,y]),{handleUndo:j,handleRedo:y}},G=e=>{let{handleAddMoveToUser:t,handleRemoveMoveFromUser:n}=(0,r.bo)();(0,i.useEffect)(()=>{let n;let s="";return d.W.on("user_draw",(l,r)=>{e?(n=l,s=r):t(r,l)}),()=>{d.W.off("user_draw"),n&&s&&t(s,n)}},[e,t]),(0,i.useEffect)(()=>(d.W.on("user_undo",e=>{n(e)}),()=>{d.W.off("user_undo")}),[n])};var V=e=>{let{bgRef:t}=e,n=Z(),{x:s,y:r}=b();return(0,i.useEffect)(()=>{var e;let s=null===(e=t.current)||void 0===e?void 0:e.getContext("2d");if(s&&(s.fillStyle="dark"===n.mode?"#222":"#fff",s.fillRect(0,0,g.width,g.height),document.body.style.backgroundColor="dark"===n.mode?"#222":"#fff",n.lines)){s.lineWidth=1,s.strokeStyle="dark"===n.mode?"#444":"#ddd";for(let e=0;e<g.height;e+=25)s.beginPath(),s.moveTo(0,e),s.lineTo(s.canvas.width,e),s.stroke();for(let e=0;e<g.width;e+=25)s.beginPath(),s.moveTo(e,0),s.lineTo(e,s.canvas.height),s.stroke()}},[t,n]),(0,l.jsx)(f.E.canvas,{ref:t,width:g.width,height:g.height,className:"absolute top-0 bg-zinc-100",style:{x:s,y:r}})},q=e=>{let{dragging:t}=e,{minimapRef:n}=p(),s=b(),{width:r,height:a}=v(),[c,d]=(0,i.useState)(0),[u,h]=(0,i.useState)(0),[m,x]=(0,i.useState)(!1);(0,i.useEffect)(()=>m?()=>{}:s.x.onChange(d),[s.x,m]),(0,i.useEffect)(()=>m?()=>{}:s.y.onChange(h),[s.y,m]);let w=(0,i.useRef)(null),j=(0,o.c)(0),y=(0,o.c)(0),N=(0,i.useMemo)(()=>r>1600?7:r>1e3?10:r>600?14:20,[r]);return(0,i.useEffect)(()=>(j.onChange(e=>{t||s.x.set(Math.floor(-e*N))}),y.onChange(e=>{t||s.y.set(Math.floor(-e*N))}),()=>{j.clearListeners(),y.clearListeners()}),[s.x,s.y,N,t,j,y]),(0,l.jsxs)("div",{className:"absolute right-10 top-10 z-30 overflow-hidden rounded-lg shadow-lg",style:{width:g.width/N,height:g.height/N},ref:w,children:[(0,l.jsx)("canvas",{ref:n,width:g.width,height:g.height,className:"h-full w-full"}),(0,l.jsx)(f.E.div,{drag:!0,dragConstraints:w,dragElastic:0,dragTransition:{power:0,timeConstant:0},onDragStart:()=>x(!0),onDragEnd:()=>x(!1),className:"absolute top-0 left-0 cursor-grab rounded-lg border-2 border-red-500",style:{width:r/N,height:a/N,x:j,y:y},animate:{x:-c/N,y:-u/N},transition:{duration:0}})]})},$=()=>{let{canvasRef:e,bgRef:t,undoRef:n,redoRef:s}=p(),{width:r,height:o}=v(),{x:a,y:c}=b(),u=w(),[h,m]=(0,i.useState)(!0),{handleEndDrawing:j,handleDraw:y,handleStartDrawing:N,drawing:k,clearOnYourMove:E}=X(h);G(k);let{handleUndo:C,handleRedo:W}=H(E);return(0,i.useEffect)(()=>{m(!1)},[]),(0,i.useEffect)(()=>{let e=e=>{m(e.ctrlKey)};window.addEventListener("keyup",e),window.addEventListener("keydown",e);let t=n.current,l=s.current;return null==t||t.addEventListener("click",C),null==l||l.addEventListener("click",W),()=>{window.removeEventListener("keyup",e),window.removeEventListener("keydown",e),null==t||t.removeEventListener("click",C),null==l||l.removeEventListener("click",W)}},[e,h,W,C,s,n]),(0,i.useEffect)(()=>{u&&d.W.emit("joined_room")},[u]),(0,l.jsxs)("div",{className:"relative h-full w-full overflow-hidden",children:[(0,l.jsx)(f.E.canvas,{ref:e,width:g.width,height:g.height,className:"absolute top-0 z-10 ".concat(h&&"cursor-move"),style:{x:a,y:c},drag:h,dragConstraints:{left:-(g.width-r),right:0,top:-(g.height-o),bottom:0},dragElastic:0,dragTransition:{power:0,timeConstant:0},onMouseDown:e=>N(e.clientX,e.clientY),onMouseUp:j,onMouseMove:e=>{y(e.clientX,e.clientY,e.shiftKey)},onTouchStart:e=>N(e.changedTouches[0].clientX,e.changedTouches[0].clientY),onTouchEnd:j,onTouchMove:e=>y(e.changedTouches[0].clientX,e.changedTouches[0].clientY)}),(0,l.jsx)(V,{bgRef:t}),(0,l.jsx)(q,{dragging:h}),(0,l.jsx)("button",{className:"absolute bottom-14 right-5 z-10 rounded-xl md:bottom-5 ".concat(h?"bg-green-500":"bg-zinc-300 text-black"," p-3 text-lg text-white"),onClick:()=>m(e=>!e),children:(0,l.jsx)(x.Ctn,{})})]})},Q=n(3758),ee=n(6773),et=()=>{let{x:e,y:t}=b(),n=(0,i.useRef)({x:0,y:0}),s=(0,i.useRef)(null),{docX:r,docY:o}=(0,Q.Z)(s),a=window.matchMedia("(pointer: coarse)").matches;return((0,ee.Z)(()=>{n.current.x===r&&n.current.y===o||a||(d.W.emit("mouse_move",y(r,e),y(o,t)),n.current={x:r,y:o})},150),a)?null:(0,l.jsxs)(f.E.div,{ref:s,className:"pointer-events-none absolute top-0 left-0 z-50 select-none transition-colors dark:text-white",animate:{x:r+15,y:o+15},transition:{duration:.05,ease:"linear"},children:[y(r,e).toFixed(0)," | ",y(o,t).toFixed(0)]})},en=e=>{var t,n;let{userId:s}=e,{users:o}=(0,r.NW)(),a=b(),[c,u]=(0,i.useState)(""),[h,m]=(0,i.useState)(a.x.get()),[g,v]=(0,i.useState)(a.y.get()),[p,w]=(0,i.useState)({x:-1,y:-1});return(0,i.useEffect)(()=>{d.W.on("mouse_moved",(e,t,n)=>{n===s&&w({x:e,y:t})});let e=(e,t)=>{e===s&&(u(t),setTimeout(()=>{u("")},3e3))};return d.W.on("new_msg",e),()=>{d.W.off("mouse_moved"),d.W.off("new_msg",e)}},[s]),(0,i.useEffect)(()=>a.x.onChange(m),[a.x]),(0,i.useEffect)(()=>a.y.onChange(v),[a.y]),(0,l.jsxs)(f.E.div,{className:"pointer-events-none absolute top-0 left-0 z-20 text-blue-800 ".concat(-1===p.x&&"hidden"),style:{color:null===(t=o.get(s))||void 0===t?void 0:t.color},animate:{x:p.x+h,y:p.y+g},transition:{duration:.2,ease:"linear"},children:[(0,l.jsx)(x.BKo,{className:"-rotate-90"}),c&&(0,l.jsx)("p",{className:"absolute top-full left-5 max-h-20 max-w-[15rem] overflow-hidden text-ellipsis rounded-md bg-zinc-900 p-1 px-3 text-white",children:c}),(0,l.jsx)("p",{className:"ml-2",children:(null===(n=o.get(s))||void 0===n?void 0:n.name)||"Anonymous"})]})},es=()=>{let{users:e}=(0,r.NW)();return(0,l.jsx)(l.Fragment,{children:[...e.keys()].map(e=>e===d.W.id?null:(0,l.jsx)(en,{userId:e},e))})},el=n(6691),er=()=>{let{canvasRef:e}=p(),{x:t,y:n}=b(),{moveImage:s,setMoveImage:r}=Y(),a=(0,o.c)(s.x||50),c=(0,o.c)(s.y||50);return((0,i.useEffect)(()=>{s.x?a.set(s.x):a.set(50),s.y?c.set(s.y):c.set(50)},[a,c,s.x,s.y]),s.base64)?(0,l.jsxs)(f.E.div,{drag:!0,dragConstraints:e,dragElastic:0,dragTransition:{power:.03,timeConstant:50},className:"absolute top-0 z-20 cursor-grab",style:{x:a,y:c},children:[(0,l.jsxs)("div",{className:"absolute bottom-full mb-2 flex gap-3",children:[(0,l.jsx)("button",{className:"rounded-full bg-gray-200 p-2",onClick:()=>{let[e,l]=[y(a.get(),t),y(c.get(),n)],i={...j,img:{base64:s.base64},path:[[e,l]],options:{...j.options,selection:null,shape:"image"}};d.W.emit("draw",i),r({base64:""}),a.set(50),c.set(50)},children:(0,l.jsx)(el.bzc,{})}),(0,l.jsx)("button",{className:"rounded-full bg-gray-200 p-2",onClick:()=>r({base64:""}),children:(0,l.jsx)(el.oHP,{})})]}),(0,l.jsx)("img",{className:"pointer-events-none",alt:"image to place",src:s.base64})]}):null},ei=n(839),eo=()=>{let e,t;let{selection:n}=C(),{selectionRefs:s}=p();if(n){let{x:s,y:l,width:r,height:i}=n;e=Math.min(l,l+i)-40,t=Math.min(s,s+r)}else t=-40,e=-40;return(0,l.jsxs)("div",{className:"absolute top-0 left-0 z-50 flex items-center justify-center gap-2",style:{top:e,left:t},children:[(0,l.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:e=>{e&&s.current&&(s.current[0]=e)},children:(0,l.jsx)(x.Ctn,{})}),(0,l.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:e=>{e&&s.current&&(s.current[1]=e)},children:(0,l.jsx)(ei.C3L,{})}),(0,l.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:e=>{e&&s.current&&(s.current[2]=e)},children:(0,l.jsx)(el.VPh,{})})]})},ea=n(6963),ec=n(6110),ed=n(9740),eu=()=>{let[e,t]=(0,i.useState)("");return(0,l.jsxs)("form",{className:"flex w-full items-center gap-2",onSubmit:n=>{n.preventDefault(),d.W.emit("send_msg",e),t("")},children:[(0,l.jsx)("input",{className:"w-full rounded-xl border border-zinc-300 p-5 py-1",value:e,onChange:e=>t(e.target.value)}),(0,l.jsx)("button",{className:"btn-icon h-full w-10 bg-black",type:"submit",children:(0,l.jsx)(el.gYb,{})})]})},eh=e=>{let{userId:t,msg:n,username:s,color:r}=e,i=d.W.id===t;return(0,l.jsxs)("div",{className:"my-2 flex gap-2 text-clip ".concat(i&&"justify-end text-right"),children:[!i&&(0,l.jsx)("h5",{style:{color:r},className:"font-bold",children:s}),(0,l.jsx)("p",{style:{wordBreak:"break-all"},children:n})]})},em=()=>{let e=(0,r.NW)(),t=(0,i.useRef)(null),[n,s]=(0,i.useState)(!1),[o,a]=(0,i.useState)(!1),[c,u]=(0,ec.Z)([]);return(0,i.useEffect)(()=>{let n=(n,l)=>{var r,i;let a=e.users.get(n);u.push({userId:n,msg:l,id:c.length+1,username:(null==a?void 0:a.name)||"Anonymous",color:(null==a?void 0:a.color)||"#000"}),null===(i=t.current)||void 0===i||i.scroll({top:null===(r=t.current)||void 0===r?void 0:r.scrollHeight}),o||s(!0)};return d.W.on("new_msg",n),()=>{d.W.off("new_msg",n)}},[u,c,o,e.users]),(0,l.jsxs)(f.E.div,{className:"absolute bottom-0 z-50 flex h-[300px] w-full flex-col overflow-hidden rounded-t-md sm:left-36 sm:w-[30rem]",animate:{y:o?0:260},transition:{ease:ed.n,duration:.2},children:[(0,l.jsxs)("button",{className:"flex w-full cursor-pointer items-center justify-between bg-zinc-900 py-2 px-10 font-semibold text-white",onClick:()=>{a(e=>!e),s(!1)},children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(x.Nm2,{className:"mt-[-2px]"}),"Chat",n&&(0,l.jsx)("p",{className:"rounded-md bg-green-500 px-1 font-semibold text-green-900",children:"New!"})]}),(0,l.jsx)(f.E.div,{animate:{rotate:o?0:180},transition:{ease:ed.n,duration:.2},children:(0,l.jsx)(ea.RiI,{})})]}),(0,l.jsxs)("div",{className:"flex flex-1 flex-col justify-between bg-white p-3",children:[(0,l.jsx)("div",{className:"h-[190px] overflow-y-scroll pr-2",ref:t,children:c.map(e=>(0,l.jsx)(eh,{...e},e.id))}),(0,l.jsx)(eu,{})]})]})},ef=n(1163),ex=n(8147),eg=n(8277),ev=()=>{let e=(0,r.u4)(),{openModal:t}=(0,ex.d)(),[n,s]=(0,i.useState)(""),o=(0,ef.useRouter)(),a=(o.query.roomId||"").toString();return(0,i.useEffect)(()=>{if(a)return d.W.emit("check_room",a),d.W.on("room_exists",e=>{e||o.push("/")}),()=>{d.W.off("room_exists")}},[a,o]),(0,i.useEffect)(()=>{let n=(n,s)=>{s?(o.push("/"),t((0,l.jsx)(eg.Z,{id:n}))):e(n)};return d.W.on("joined",n),()=>{d.W.off("joined",n)}},[t,o,e]),(0,l.jsxs)("form",{className:"my-24 flex flex-col items-center",onSubmit:e=>{e.preventDefault(),d.W.emit("join_room",a,n)},children:[(0,l.jsx)("h1",{className:"text-5xl font-extrabold leading-tight sm:text-extra",children:"Collabio"}),(0,l.jsx)("h3",{className:"text-xl sm:text-2xl",children:"Real-time whiteboard"}),(0,l.jsxs)("div",{className:"mt-10 mb-3 flex flex-col gap-2",children:[(0,l.jsx)("label",{className:"self-start font-bold leading-tight",children:"Enter your name"}),(0,l.jsx)("input",{className:"rounded-xl border p-5 py-1",id:"room-id",placeholder:"Username...",value:n,onChange:e=>s(e.target.value.slice(0,15))})]}),(0,l.jsx)("button",{className:"btn",type:"submit",children:"Enter room"})]})},eb=n(8198),ep=n(3296),ew=n(2567),ej=()=>{let{id:e}=(0,r.NW)(),{closeModal:t}=(0,ex.d)(),[n,s]=(0,i.useState)("");return(0,i.useEffect)(()=>s(window.location.href),[]),(0,l.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10 pt-5",children:[(0,l.jsx)("button",{onClick:t,className:"absolute top-5 right-5",children:(0,l.jsx)(el.oHP,{})}),(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Invite"}),(0,l.jsxs)("h3",{children:["Room id: ",(0,l.jsx)("p",{className:"inline font-bold",children:e})]}),(0,l.jsxs)("div",{className:"relative mt-2",children:[(0,l.jsx)("input",{type:"text",value:n,readOnly:!0,className:"input sm:w-96"}),(0,l.jsx)("button",{className:"btn absolute right-0 h-full",onClick:()=>navigator.clipboard.writeText(n),children:"Copy"})]})]})},ey=n(9411),eN=()=>{let{closeModal:e}=(0,ex.d)(),t=U(),n=Z();(0,i.useEffect)(()=>e,[n,e]);let s=(e,t,n)=>{let s=null==e?void 0:e.getContext("2d");if(s&&(s.fillStyle="dark"===t?"#222":"#fff",s.fillRect(0,0,s.canvas.width,s.canvas.height),n)){s.lineWidth=1,s.strokeStyle="dark"===t?"#444":"#ddd";for(let e=0;e<s.canvas.height;e+=10)s.beginPath(),s.moveTo(0,e),s.lineTo(s.canvas.width,e),s.stroke();for(let e=0;e<s.canvas.width;e+=10)s.beginPath(),s.moveTo(e,0),s.lineTo(e,s.canvas.height),s.stroke()}};return(0,l.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10",children:[(0,l.jsx)("button",{onClick:e,className:"absolute top-5 right-5",children:(0,l.jsx)(el.oHP,{})}),(0,l.jsx)("h2",{className:"mb-4 text-2xl font-bold",children:"Choose background"}),(0,l.jsxs)("div",{className:"grid gap-5 sm:grid-cols-2",children:[(0,l.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("dark",!0),ref:e=>s(e,"dark",!0)}),(0,l.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("light",!0),ref:e=>s(e,"light",!0)}),(0,l.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("dark",!1),ref:e=>s(e,"dark",!1)}),(0,l.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:()=>t("light",!1),ref:e=>s(e,"light",!1)})]})]})},ek=()=>{let{openModal:e}=(0,ex.d)();return(0,l.jsx)("button",{className:"btn-icon",onClick:()=>e((0,l.jsx)(eN,{})),children:(0,l.jsx)(ey.bTn,{})})},eE=n(1190),eC=n(5907),eW=n(4841);let eM={from:{y:-30,opacity:0,transition:{ease:ed.n,duration:.2}},to:{y:0,opacity:1,transition:{ease:ed.n,duration:.2}}};var eS=()=>{let[e,t]=M(),n=(0,i.useRef)(null),[s,r]=(0,i.useState)(!1);return(0,eW.Z)(n,()=>r(!1)),(0,l.jsxs)("div",{className:"relative flex items-center",ref:n,children:[(0,l.jsx)("button",{className:"btn-icon",onClick:()=>r(!s),disabled:"select"===e.mode,children:(0,l.jsx)(x.woE,{})}),(0,l.jsx)(eE.M,{children:s&&(0,l.jsxs)(f.E.div,{className:"absolute left-10 mt-24 sm:left-14",variants:eM,initial:"from",animate:"to",exit:"from",children:[(0,l.jsx)("h2",{className:"ml-3 font-semibold text-black dark:text-white",children:"Line color"}),(0,l.jsx)(eC.Jg,{color:e.lineColor,onChange:n=>{t({...e,lineColor:n})},className:"mb-5"}),(0,l.jsx)("h2",{className:"ml-3 font-semibold text-black dark:text-white",children:"Fill color"}),(0,l.jsx)(eC.Jg,{color:e.fillColor,onChange:n=>{t({...e,fillColor:n})}})]})})]})},eL=()=>{let{redoRef:e,undoRef:t}=p(),{myMoves:n}=(0,r.av)(),s=P();return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"btn-icon text-xl",ref:e,disabled:!s.length,children:(0,l.jsx)(ea.WLu,{})}),(0,l.jsx)("button",{className:"btn-icon text-xl",ref:t,disabled:!n.length,children:(0,l.jsx)(ea.wXW,{})})]})},eR=n(6770),eP=n.n(eR);let e_=(e,t)=>{eP().imageFileResizer(e,700,700,"WEBP",100,0,e=>{t(e.toString())},"base64")};var eT=()=>{let{setMoveImage:e}=Y();return(0,i.useEffect)(()=>{let t=t=>{var n;let s=null===(n=t.clipboardData)||void 0===n?void 0:n.items;if(s){for(let t of s)if(t.type.includes("image")){let n=t.getAsFile();n&&e_(n,t=>e({base64:t}))}}};return document.addEventListener("paste",t),()=>{document.removeEventListener("paste",t)}},[e]),(0,l.jsx)("button",{className:"btn-icon text-xl",onClick:()=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.click(),t.addEventListener("change",()=>{t&&t.files&&e_(t.files[0],t=>e({base64:t}))})},children:(0,l.jsx)(x.vGR,{})})},eI=()=>{let[e,t]=M(),n=(0,i.useRef)(null),[s,r]=(0,i.useState)(!1);return(0,eW.Z)(n,()=>r(!1)),(0,l.jsxs)("div",{className:"relative flex items-center",ref:n,children:[(0,l.jsx)("button",{className:"btn-icon text-xl",onClick:()=>r(!s),disabled:"select"===e.mode,children:(0,l.jsx)(x.S2O,{})}),(0,l.jsx)(eE.M,{children:s&&(0,l.jsx)(f.E.div,{className:"absolute top-[6px] left-14 w-36",variants:eM,initial:"from",animate:"to",exit:"from",children:(0,l.jsx)("input",{type:"range",min:1,max:20,value:e.lineWidth,onChange:e=>t(t=>({...t,lineWidth:parseInt(e.target.value,10)})),className:"h-4 w-full cursor-pointer appearance-none rounded-lg bg-gray-200"})})})]})},eD=()=>{let[e,t]=M(),{clearSelection:n}=S();return(0,i.useEffect)(()=>{n()},[e.mode]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"btn-icon text-xl ".concat("draw"===e.mode&&"bg-green-400"),onClick:()=>{t(e=>({...e,mode:"draw"}))},children:(0,l.jsx)(x.Aac,{})}),(0,l.jsx)("button",{className:"btn-icon text-xl ".concat("eraser"===e.mode&&"bg-green-400"),onClick:()=>{t(e=>({...e,mode:"eraser"}))},children:(0,l.jsx)(ea.arg,{})}),(0,l.jsx)("button",{className:"btn-icon text-2xl ".concat("select"===e.mode&&"bg-green-400"),onClick:()=>{t(e=>({...e,mode:"select"}))},children:(0,l.jsx)(el.AJi,{})})]})},ez=n(9281),eF=()=>{let[e,t]=M(),n=(0,i.useRef)(null),[s,r]=(0,i.useState)(!1);(0,eW.Z)(n,()=>r(!1));let o=e=>{t(t=>({...t,shape:e})),r(!1)};return(0,l.jsxs)("div",{className:"relative flex items-center",ref:n,children:[(0,l.jsxs)("button",{className:"btn-icon text-2xl",disabled:"select"===e.mode,onClick:()=>r(e=>!e),children:["circle"===e.shape&&(0,l.jsx)(x.b9R,{}),"rect"===e.shape&&(0,l.jsx)(ez.v3P,{}),"line"===e.shape&&(0,l.jsx)(ey.slm,{})]}),(0,l.jsx)(eE.M,{children:s&&(0,l.jsxs)(f.E.div,{className:"absolute left-14 z-10 flex gap-1 rounded-lg border bg-zinc-900 p-2 md:border-0",variants:eM,initial:"from",animate:"to",exit:"from",children:[(0,l.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>o("line"),children:(0,l.jsx)(ey.slm,{})}),(0,l.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>o("rect"),children:(0,l.jsx)(ez.v3P,{})}),(0,l.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>o("circle"),children:(0,l.jsx)(x.b9R,{})})]})})]})},eA=()=>{let{canvasRef:e,bgRef:t}=p(),{openModal:n}=(0,ex.d)(),{width:s}=v(),[r,o]=(0,i.useState)(!1),a=(0,ef.useRouter)();return(0,i.useEffect)(()=>{s>=1024?o(!0):o(!1)},[s]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.E.button,{className:"btn-icon absolute bottom-1/2 -left-2 z-50 h-10 w-10 rounded-full bg-black text-2xl transition-none lg:hidden",animate:{rotate:r?0:180},transition:{duration:.2,ease:ed.n},onClick:()=>o(!r),children:(0,l.jsx)(ei.Tfp,{})}),(0,l.jsxs)(f.E.div,{className:"absolute left-10 top-[50%] z-50 grid grid-cols-2 items-center gap-5 rounded-lg bg-zinc-900 p-5 text-white 2xl:grid-cols-1",animate:{x:r?0:-160,y:"-50%"},transition:{duration:.2,ease:ed.n},children:[(0,l.jsx)(eL,{}),(0,l.jsx)("div",{className:"h-px w-full bg-white 2xl:hidden"}),(0,l.jsx)("div",{className:"h-px w-full bg-white"}),(0,l.jsx)(eF,{}),(0,l.jsx)(eS,{}),(0,l.jsx)(eI,{}),(0,l.jsx)(eD,{}),(0,l.jsx)(eT,{}),(0,l.jsx)("div",{className:"2xl:hidden"}),(0,l.jsx)("div",{className:"h-px w-full bg-white 2xl:hidden"}),(0,l.jsx)("div",{className:"h-px w-full bg-white"}),(0,l.jsx)(ek,{}),(0,l.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>n((0,l.jsx)(ej,{})),children:(0,l.jsx)(ew.qSo,{})}),(0,l.jsx)("button",{className:"btn-icon text-2xl",onClick:()=>{let n=document.createElement("canvas");n.width=g.width,n.height=g.height;let s=n.getContext("2d");s&&e.current&&t.current&&(s.drawImage(t.current,0,0),s.drawImage(e.current,0,0));let l=document.createElement("a");l.href=n.toDataURL("image/png"),l.download="canvas.png",l.click()},children:(0,l.jsx)(eb.yFZ,{})}),(0,l.jsx)("button",{className:"btn-icon text-xl",onClick:()=>a.push("/"),children:(0,l.jsx)(ep.T$9,{})})]})]})},eX=()=>{let{users:e}=(0,r.NW)();return(0,l.jsx)("div",{className:"pointer-events-none absolute z-30 flex p-5",children:[...e.keys()].map((t,n)=>{var s,r;return(0,l.jsx)("div",{className:"flex h-5 w-5 select-none items-center justify-center rounded-full text-xs text-white md:h-8 md:w-8 md:text-base lg:h-12 lg:w-12",style:{backgroundColor:(null===(s=e.get(t))||void 0===s?void 0:s.color)||"black",marginLeft:0!==n?"-0.5rem":0},children:(null===(r=e.get(t))||void 0===r?void 0:r.name.split("")[0])||"A"},t)})})},eO=()=>(0,r.NW)().id?(0,l.jsx)(m,{children:(0,l.jsxs)("div",{className:"relative h-full w-full overflow-hidden",children:[(0,l.jsx)(eX,{}),(0,l.jsx)(eA,{}),(0,l.jsx)(eo,{}),(0,l.jsx)(er,{}),(0,l.jsx)($,{}),(0,l.jsx)(et,{}),(0,l.jsx)(es,{}),(0,l.jsx)(em,{})]})}):(0,l.jsx)(ev,{}),eZ=()=>(0,l.jsx)(eO,{})}},function(e){e.O(0,[617,866,609,556,152,445,955,13,874,483,32,888,774,179],function(){return e(e.s=7933)}),_N_E=e.O()}]);